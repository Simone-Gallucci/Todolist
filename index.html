<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>To-Do List Avanzata</title>
  <style>
    /* Stile generale */
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      margin: 0; /* Aggiunto per rimuovere il margine predefinito del body */
      display: flex; /* Aggiunto per abilitare Flexbox */
      justify-content: center; /* Centra orizzontalmente */
      align-items: center; /* Centra verticalmente */
      min-height: 100vh; /* Assicura che il body occupi almeno l'intera altezza della viewport */
    }

    .container {
      background-color: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
      width: max-content; /* o una larghezza fissa se preferisci */
    }

    #todo-form label {
      margin-bottom:5px;  
      display:block;   
    }

    #todo-form input[type=text], textarea {
      width:100%;
      padding-top:10px;  
      padding-bottom:10px;  
      margin-bottom:15px;  
      border-radius :5px;
      border-style:solid;
      border-width :thin;
    }

   textarea {
       height:auto !important;
   }

   .delete-btn {
       background-color:red !important;
       color:white !important;
   }

   .todo-item {
       display:flex;
       justify-content:start;
       align-items:center;
       margin-top :10px;
   }

   .todo-item span.title {
      flex-grow :1
   }

   .completed span.title {
      text-decoration :line-through
   }

   input[type='datetime-local'] {
      width:max-content
   }

   label[for='completed'] {
      display:inline-block;
      margin-left:-2em;
   }

   input[name='completed'] {
      margin-right:.5em;
   }

   button[type='submit'] {
      background-color:#007bff;
      color:white;
      border:none;
      padding:.7em;
      border-radius:.3em;
   }

   button[type='submit']:hover {
      background-color:#0056b3;
   }
  </style>
</head>

<body>
  <div class="container">
    <h1>To-Do List Avanzata</h1>
    <form id="todo-form">
      <label for="title">Titolo:</label><br />
      <input type="text" id="title" required placeholder="Inserisci il titolo dell'attività...">
      <br>

      <label for="datetime">Data e Ora:</label><br />
      <input type='datetime-local' id='datetime' required>
      <br />

      <label for='description'>Descrizione:</label><br />
      <textarea id='description' rows='4'></textarea>
      <br />

      Completato:
      Sì<input type='radio' name='completed' value=true checked> 
      No<input type='radio' name='completed' value=false> 
      <br>

      <button type=submit>Aggiungi Attività</button>
    </form>

    <ul id="todo-list"></ul>
  </div>

  <script>
    const todoForm = document.getElementById("todo-form");
    const todoList = document.getElementById("todo-list");

    let todos = [];

    function createTodoItem(todo) {
      const li = document.createElement("li");
      li.classList.add("todo-item");

      const titleSpan = document.createElement("span");
      titleSpan.textContent =
        `${new Date(todo.datetime).toLocaleString('it-IT', {dateStyle:'short', timeStyle:'short'})} - ${todo.title}`;
      titleSpan.addEventListener('click', () => {        
        li.classList.toggle('completed');
        todo.completed = li.classList.contains('completed');        
      });

      const descDiv=document.createElement('div')
      descDiv.style.marginLeft ='20px'

      if (typeof todo.description !== 'undefined') {
        descDiv.textContent=`Descrizione:\n${(typeof todo.description === 'string') ? (typeof todos[todos.indexOf(todo)].description === 'string') ? todos[todos.indexOf(todo)].description:'nessun valore': "Nessuna descrizione fornita"}`
        } else {descDiv.textContent ="Nessuna descrizione fornita"}

      const deleteBtn=document.createElement('button')
      deleteBtn.textContent=('Elimina')
      deleteBtn.className=('delete-btn')

      deleteBtn.addEventListener ('click', () => {        
          const index=todos.findIndex((t)=> t===Object.assign({},t,todo))
          if(index!==-1){
            todos.splice(index,1);
            updateList();
            localStorage.setItem(`todos`, JSON.stringify(todos));
          }
        });
      
      (li.appendChild(titleSpan))
      (li.appendChild(descDiv))
      (li.appendChild(deleteBtn))

      return(li)
    }

    function addTodo(event) {
      event.preventDefault();

      let newDatetime=event.target.elements[2].valueAsDate.toISOString().split('.')[0];

      if (!newDatetime || newDatetime.length<11 ) newDatetime=new Date().toISOString().split('.')[0];

      let newDescription=event.target.elements[3].value.trim()===""?"":event.target.elements[3].value.trim()

      let radioButtons=event.querySelectorAll('[name=completed]')
      let newCompleted=false
      
      for(let rb of radioButtons){
        
      if(rb.checked && rb.value==='true'){
      newCompleted=true
        
      break
        
      } else if(rb.checked && rb.value==='false'){
      newCompleted=false
        
      break
        
          
            
          
          
            
          
          
          
      
          
          
      
      
      

      
      radioButtons.forEach(rb=>rb.checked=false)
      radioButtons[0].checked=true
      
      newCompleted=false
      
      event.preventDefault()
      return false
          
            
          
          
            
           
        
      
        
      
      
      

      
      
      
      
      
      
      
      radioButtons.forEach(rb=>rb.checked=false)
      radioButtons[0].checked=true
      
      newCompleted=false
      
      event.preventDefault()
      return false
          
            
          
          
            
           
        
      
        
      
      
      

      
      
      
      
      
      
      
      radioButtons.forEach(rb=>rb.checked=false)
      radioButtons[0].checked=true 
      
      newCompleted=false 
      
      event.preventDefault()
      return false
          
            
            
            
            
             
        
            
            
            
             
      
             
      
          
            
            
            
              
                
                  
                    
                       event.stopPropagation(); return true
                
            
            
            
            
            
              })
              
              radioChecked=null
                
                 break
                
                 default:
                   continue
                
                 case undefined:
                   continue
                }
                
        const newTitle=event.target.elements["title"].value.trim()===""?"":event.target.elements["title"].value.trim()

        if(!newTitle)return alert ("Inserisci un Titolo")

        const newTodo={
          title:newTitle,
          datetime:newDatetime,
          description:newDescription,
          completed:newCompleted,
        };

        todos.push(newTodo);

        updateList();

        localStorage.setItem(`todos`, JSON.stringify(todos));

        event.target.reset()
    }

    function updateList() {
        while (document.querySelector('#list')){document.querySelector('#list').remove()};

        let listElement=document.createElement('ul');

        listElement.id=('list')

        for(const todo of todos){
            let item=createTodoItem(todo);

            item.id=(`item-${todos.indexOf(todo)}`)

            if(document.querySelector('#list')){
                listElement.append(item); 
            }else{
                todoList.append(listElement);
            }           
        }

        localStorage.setItem(`todos`, JSON.stringify(todos));
    }

    // Carica i dati salvati in localeStorage all'avvio della pagina.
    window.onload=function(){
      try {
        if(localStorage.getItem(`todos`)!==null){
          let storedTodos=JSON.parse(localStorage.getItem(`todos`))

          for(const stored of storedTodos){
            stored.completed=(stored.completed===true||stored.completed==='true')

            if(stored.datetime.includes('-')){}else{ stored.datetime=new Date().toISOString().split('.')[0] }
              todos.push(stored)

            updateList()
          }
        }
      } catch(e) {
        console.error(e);
      }
    };

    // Aggiungi evento al form quando viene inviato.
    document.getElementById("todo-form").addEventListener(
    'submit',
    addTodo,false);
  </script>
</body>
</html>
